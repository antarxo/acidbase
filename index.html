<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Ρεαλιστική Προσομοίωση με p5.js</title>
  <!-- Φόρτωση του p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
  <script>
    // Μεταβλητές για τις εικόνες
    let pipetteImg, beakerImg;
    
    // Μεταβλητές για το animation και το γέμισμα
    let beakerFill = 0;      // ποσοστό γέμισματος του ποτηριού (0-100)
    let dropY;               // τρέχουσα θέση της σταγόνας
    let dropActive = false;  // αν η σταγόνα κινείται
    let dropSpeed = 5;       // ταχύτητα της σταγόνας
    
    // Σταθερές για τις διαστάσεις του pipet
    let pipetteX = 100;      
    let pipetteY = 120;
    let pipetteW = 80, pipetteH = 150;
    
    // Διαστάσεις του beaker (εικόνα)
    let beakerW = 150, beakerH = 250;
    // Offset μεταξύ του pipet και του beaker
    let beakerOffset = 20;
    // Η θέση του beaker υπολογίζεται δυναμικά: 
    // pipetteBottom + beakerH/2 + offset
    let beakerY;  
    
    // Παράμετροι για το σχεδιασμό του υγρού
    let scaleFactor = 10; // παράγοντας κλίμακας για τις διαστάσεις της έλλειψης
    // Διαστάσεις της έλλειψης που ορίζουν το πλάτος του υγρού:
    let liquidEllipseWidth = 6.36 * scaleFactor;
    let liquidEllipseHeight = 1.93 * scaleFactor;
    // Offsets για το εσωτερικό του beaker:
    let bottomOffset = 15; // απόσταση από το κάτω μέρος του beaker για την κάτω έλλειψη
    let topOffset = 20;    // απόσταση από το πάνω μέρος του beaker για το ανώτερο όριο
    
    // Αρχική θέση για τη σταγόνα (ξεκινά κοντά στο pipet)
    let initialDropY = 100;
    
    function preload() {
      // Φόρτωση των εικόνων
      pipetteImg = loadImage('pipet2.png', () => {
        console.log("pipet2.png loaded successfully");
      }, () => {
        console.error("Error loading pipet2.png");
      });
      
      beakerImg = loadImage('beaker2.png', () => {
        console.log("beaker2.png loaded successfully");
      }, () => {
        console.error("Error loading beaker2.png");
      });
    }
    
    function setup() {
      createCanvas(400, 600);
      console.log("Setup executed, canvas created");
      
      // Υπολογισμός του κάτω μέρους του pipet και θέσης του beaker
      let pipetteBottom = pipetteY + pipetteH / 2;
      beakerY = pipetteBottom + beakerH / 2 + beakerOffset;
      
      // Αρχικοποίηση της θέσης της σταγόνας
      dropY = initialDropY;
      
      // Δημιουργία κουμπιών για αλληλεπίδραση
      let btnFill = createButton("Προσθήκη Αντιδραστηρίου");
      btnFill.position(10, height + 20);
      btnFill.mousePressed(startDrop);
      
      let btnReset = createButton("Επαναφορά");
      btnReset.position(200, height + 20);
      btnReset.mousePressed(resetFill);
    }
    
    function draw() {
      background(240);
      
      // Σχεδίαση του pipet (στην αριστερή πλευρά)
      imageMode(CENTER);
      if(pipetteImg) {
        image(pipetteImg, pipetteX, pipetteY, pipetteW, pipetteH);
      } else {
        fill(200);
        rect(pipetteX - pipetteW/2, pipetteY - pipetteH/2, pipetteW, pipetteH);
        console.error("pipetteImg is not loaded");
      }
      
      // Σχεδίαση του beaker στο κέντρο οριζόντια αλλά με θέση beakerY που υπολογίστηκε δυναμικά
      imageMode(CENTER);
      if(beakerImg) {
        image(beakerImg, width/2, beakerY, beakerW, beakerH);
      } else {
        fill(255);
        rect(width/2, beakerY, beakerW, beakerH);
        console.error("beakerImg is not loaded");
      }
      
      // Σχεδίαση του υγρού μέσα στο ποτήρι
      drawLiquid();
      
      // Αν η σταγόνα είναι ενεργή, σχεδιάζουμε και την κίνησή της
      if(dropActive) {
        drawDrop();
        dropY += dropSpeed;
        // Υπολογισμός του ορίου για την προσθήκη του υγρού, βασισμένο στο κάτω όριο του beaker
        let bottomLiquidY = beakerY + beakerH/2 - bottomOffset;
        if(dropY > bottomLiquidY - liquidEllipseHeight/2) {
          dropActive = false;
          dropY = initialDropY; // επαναφορά της θέσης της σταγόνας
          beakerFill = min(beakerFill + 10, 100);
          console.log("Incremented beakerFill to:", beakerFill);
        }
      }
    }
    
    // Συνάρτηση για σχεδίαση του υγρού μέσα στο ποτήρι
    // Το υγρό αποτελείται από:
    // 1. Ένα ορθογώνιο που έχει πλάτος ίσο με το πλάτος της έλλειψης και εκτείνεται από τον οριζόντιο άξονα της κάτω έλλειψης έως την πάνω μετακινούμενη έλλειψη.
    // 2. Μία σταθερή έλλειψη στον πυθμένα.
    // 3. Μία πάνω έλλειψη που μετακινείται ανάλογα με το επίπεδο γεμίσματος.
    function drawLiquid() {
      // Υπολογισμός των ορίων μέσα στο beaker
      let bottomLiquidY = beakerY + beakerH/2 - bottomOffset;  // οριζόντιος άξονας για την κάτω (σταθερή) έλλειψη
      let topLiquidLimit = beakerY - beakerH/2 + topOffset;      // το μέγιστο σημείο που μπορεί να φτάσει το υγρό
      let maxLiquidHeight = bottomLiquidY - topLiquidLimit;
      // Μεταβολή του ύψους του υγρού βάσει του beakerFill
      let liquidHeight = map(beakerFill, 0, 100, 0, maxLiquidHeight);
      // Η πάνω μετακινούμενη έλλειψη θα έχει κέντρο στο σημείο που ορίζεται από το liquidHeight
      let topLiquidY = bottomLiquidY - liquidHeight;
      
      noStroke();
      fill(30, 136, 229); // solid χρώμα
      
      // Σχεδίαση του ορθογωνίου του υγρού
      rectMode(CORNER);
      rect(width/2 - liquidEllipseWidth/2, topLiquidY, liquidEllipseWidth, liquidHeight);
      
      // Σχεδίαση της πάνω (μετακινούμενης) έλλειψης
      ellipseMode(CENTER);
      ellipse(width/2, topLiquidY, liquidEllipseWidth, liquidEllipseHeight);
      
      // Σχεδίαση της σταθερής, κάτω έλλειψης
      ellipse(width/2, bottomLiquidY, liquidEllipseWidth, liquidEllipseHeight);
    }
    
    // Συνάρτηση για σχεδίαση της σταγόνας που έρχεται από το pipet
    function drawDrop() {
      push();
      fill(30, 136, 229);
      noStroke();
      ellipse(pipetteX, dropY, 10, 15);
      pop();
    }
    
    // Όταν πατηθεί το κουμπί "Προσθήκη Αντιδραστηρίου"
    function startDrop() {
      if (!dropActive) {
        dropActive = true;
        console.log("Drop started");
      }
    }
    
    // Όταν πατηθεί το κουμπί "Επαναφορά"
    function resetFill() {
      beakerFill = 0;
      dropY = initialDropY;
      dropActive = false;
      console.log("Reset executed");
    }
  </script>
</body>
</html>
