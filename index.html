<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Προσομοίωση με pipet3 & breaker3 (Centered Canvas)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;  /* Κεντράρει οριζόντια */
      align-items: center;  /* Κεντράρει κάθετα */
      height: 100vh;  /* Πλήρες ύψος οθόνης */
      margin: 0;
      background-color: #f0f0f0;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    let pipetteImg, breakerImg;
    
    let beakerFill = 0; // Ποσοστό γεμίσματος
    let dropY;
    let dropActive = false;
    let dropSpeed = 5;
    
    // Κλίμακα εικόνων 50%
    let scaleFactorImages = 0.5;

    // Διαστάσεις εικόνων μετά το scaling
    let pipetScaledW, pipetScaledH;
    let breakerScaledW, breakerScaledH;
    
    // Θέσεις
    let pipetX, pipetY;
    let breakerX, breakerY;
    
    // Αρχική θέση της σταγόνας
    let initialDropY;
    
    // Πλάτος περιεχομένου του ποτηριού = 0.7 * το πλάτος του breaker
    let liquidWidth, liquidHeight;
    
    // Offset για μετατόπιση προς τα αριστερά (σταγόνα & υγρό)
    let shiftOffset = 20;
    
    function preload() {
      pipetteImg = loadImage('pipet3.png', 
        () => console.log("pipet3.png loaded successfully"),
        () => console.error("Error loading pipet3.png")
      );
      breakerImg = loadImage('breaker3.png', 
        () => console.log("breaker3.png loaded successfully"),
        () => console.error("Error loading breaker3.png")
      );
    }
    
    function setup() {
      // Ορισμός διαστάσεων του καμβά
      let canvasWidth = pipetteImg.width * scaleFactorImages;
      let canvasHeight = (pipetteImg.height + breakerImg.height) * scaleFactorImages;
      let canvas = createCanvas(canvasWidth, canvasHeight);
      
      // Κεντράρει τον καμβά στη σελίδα
      canvas.position((windowWidth - width) / 2, (windowHeight - height) / 2);
      
      // Υπολογισμός διαστάσεων εικόνων με scaling
      pipetScaledW = pipetteImg.width * scaleFactorImages;
      pipetScaledH = pipetteImg.height * scaleFactorImages;
      breakerScaledW = breakerImg.width * scaleFactorImages;
      breakerScaledH = breakerImg.height * scaleFactorImages;
      
      // Τοποθέτηση pipet3
      pipetX = (width - pipetScaledW) / 2;  
      pipetY = 0;
      
      // Το κάτω άκρο του pipet3 συμπίπτει με το πάνω άκρο του breaker3
      let pipetBottom = pipetY + pipetScaledH;
      initialDropY = pipetBottom;
      
      // Τοποθέτηση breaker3
      breakerX = (width - breakerScaledW) / 2;
      breakerY = pipetBottom;
      
      // Υπολογισμός του πλάτους & ύψους του υγρού
      liquidWidth = breakerScaledW * 0.7;
      liquidHeight = liquidWidth * 0.3; 

      dropY = initialDropY;
      
      // Δημιουργία κουμπιών
      let btnFill = createButton("Προσθήκη Αντιδραστηρίου");
      btnFill.position(10, height + 20);
      btnFill.mousePressed(startDrop);
      
      let btnReset = createButton("Επαναφορά");
      btnReset.position(200, height + 20);
      btnReset.mousePressed(resetFill);
    }
    
    function draw() {
      background(240);
      
      // Υπολογισμός των θέσεων για το υγρό
      let containerTop = breakerY + 30;
      let containerBottom = breakerY + breakerScaledH - 20;
      let maxLiquidHeight = containerBottom - containerTop;
      let liquidFillHeight = map(beakerFill, 0, 100, 0, maxLiquidHeight);
      let topLiquidY = containerBottom - liquidFillHeight;
      let liquidX = breakerX + (breakerScaledW - liquidWidth) / 2;
      
      // 1. Σχεδίαση του υγρού (πίσω από το ποτήρι)
      noStroke();
      fill(30, 136, 229);
      rectMode(CORNER);
      rect(liquidX, topLiquidY, liquidWidth, liquidFillHeight);
      
      ellipseMode(CENTER);
      ellipse(liquidX + liquidWidth/2, topLiquidY, liquidWidth, liquidHeight);
      ellipse(liquidX + liquidWidth/2, containerBottom, liquidWidth, liquidHeight);
      
      // 2. Σχεδίαση του ποτηριού (πάνω από το υγρό)
      imageMode(CORNER);
      image(breakerImg, breakerX, breakerY, breakerScaledW, breakerScaledH);
      
      // 3. Σχεδίαση του pipet3 (πάνω από το ποτήρι)
      image(pipetteImg, pipetX, pipetY, pipetScaledW, pipetScaledH);
      
      // 4. Σχεδίαση και κίνηση της σταγόνας
      if(dropActive) {
        drawDrop();
        dropY += dropSpeed;
        if(dropY > containerBottom - liquidHeight / 2) {
          dropActive = false;
          dropY = initialDropY;
          beakerFill = min(beakerFill + 10, 100);
        }
      }
    }
    
    function drawDrop() {
      push();
      fill(30, 136, 229);
      noStroke();
      ellipse(pipetX + pipetScaledW / 2, dropY, 10, 15);
      pop();
    }
    
    function startDrop() {
      if (!dropActive) {
        dropActive = true;
      }
    }
    
    function resetFill() {
      beakerFill = 0;
      dropY = initialDropY;
      dropActive = false;
    }
    
    function windowResized() {
      // Επανατοποθέτηση του καμβά στο κέντρο όταν αλλάζει το μέγεθος του παραθύρου
      let canvasX = (windowWidth - width) / 2;
      let canvasY = (windowHeight - height) / 2;
      resizeCanvas(width, height);
      select('canvas').position(canvasX, canvasY);
    }
  </script>
</body>
</html>
