<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <title>Προσομοίωση - Ρύθμιση Υψηλότητας Περιεχομένου & 3D Κουμπί</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }
    canvas {
      display: block;
      z-index: -20;
    }
    .controls {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <script>
    let pipetteImg, breakerImg;
    
    let beakerFill = 0; // Η τιμή που αυξάνεται κατά 3 κάθε φορά
    let dropY;
    let dropActive = false;
    let dropSpeed = 5;
    let showBaseEllipse = false; 
    
    let scaleFactorImages = 0.5;
    
    let pipetScaledW, pipetScaledH;
    let breakerScaledW, breakerScaledH;
    
    let pipetX, pipetY;
    let breakerX, breakerY;
    
    let initialDropY;
    
    // Ρυθμίσεις για το εικονικό κουμπί πάνω στην pipet
    let buttonRadius = 15;
    let buttonCenterX, buttonCenterY;
    
    function preload() {
      pipetteImg = loadImage('pipet3.png');
      breakerImg = loadImage('breaker3.png');
    }
    
    function setup() {
      pipetScaledW = pipetteImg.width * scaleFactorImages;
      pipetScaledH = pipetteImg.height * scaleFactorImages;
      breakerScaledW = breakerImg.width * scaleFactorImages;
      breakerScaledH = breakerImg.height * scaleFactorImages;
      
      let canvasWidth = breakerScaledW;
      let canvasHeight = pipetScaledH + breakerScaledH;
      
      createCanvas(canvasWidth, canvasHeight).parent("canvas-container");
      
      pipetX = (width - pipetScaledW) / 2;  
      pipetY = 0;
      
      let pipetBottom = pipetY + pipetScaledH;
      initialDropY = pipetBottom;
      
      breakerX = (width - breakerScaledW) / 2;
      breakerY = pipetBottom;
      
      dropY = initialDropY;
      
      // Ορισμός θέσης του εικονικού κουμπιού:
      // Προσθέτουμε 15 pixel στο buttonCenterY για μετατόπιση προς τα κάτω
      buttonCenterX = pipetX + pipetScaledW - buttonRadius - 5;
      buttonCenterY = pipetY + buttonRadius + 5 + 15;
      
      // Δημιουργούμε μόνο το κουμπί "Επαναφορά" για την επαναφορά της προσομοίωσης
      createButton("Επαναφορά").parent("controls").mousePressed(resetFill);
    }
    
    function draw() {
      background(240);
      
      // Ορισμός της βάσης του ποτηριού (breaker)
      let containerBottom = breakerY + breakerScaledH - 20;
      
      // Το ορατό ύψος του υγρού υπολογίζεται ως το 75% της τιμής του beakerFill
      let drawnLiquidHeight = beakerFill * 0.75;
      
      // Σχεδιάζουμε το ορθογώνιο του υγρού χρησιμοποιώντας το χρώμα #EAEAEA
      noStroke();
      fill(234, 234, 234);
      let liquidX = (breakerX + (breakerScaledW - (breakerScaledW * 0.7 - 9)) / 2) - 13;
      let topLiquidY = containerBottom - drawnLiquidHeight;
      let liquidWidth = breakerScaledW * 0.7 - 9;
      rect(liquidX, topLiquidY, liquidWidth, drawnLiquidHeight);
      
      // Σχεδιάζουμε την κάτω έλλειψη αν έχει ξεκινήσει η πλήρωση
      if (showBaseEllipse) {
        noStroke();
        fill(234, 234, 234);
        ellipseMode(CENTER);
        ellipse(liquidX + liquidWidth / 2, containerBottom, liquidWidth, liquidWidth * 0.3);
      }
      
      // Σχεδιάζουμε το ποτήρι (breaker)
      imageMode(CORNER);
      image(breakerImg, breakerX, breakerY, breakerScaledW, breakerScaledH);
      
      // Σχεδιάζουμε την πάνω έλλειψη με περίγραμμα πάνω από το υγρό
      stroke(180);
      strokeWeight(1);
      fill(234, 234, 234);
      ellipseMode(CENTER);
      ellipse(liquidX + liquidWidth / 2, topLiquidY, liquidWidth, liquidWidth * 0.3);
      noStroke();
      
      // Σχεδιάζουμε την pipet
      image(pipetteImg, pipetX, pipetY, pipetScaledW, pipetScaledH);
      
      // Κίνηση της σταγόνας και ενημέρωση του επιπέδου του υγρού
      if (dropActive) {
        drawDrop();
        dropY += dropSpeed;
        if (dropY > containerBottom - (liquidWidth * 0.3) / 2) {
          dropActive = false;
          dropY = initialDropY;
          // Αύξηση του beakerFill κατά 3 pixels από την τρέχουσα τιμή
          beakerFill += 3;
          showBaseEllipse = true;
        }
      }
      
      // Σχεδιάζουμε το εικονικό κουμπί με εφέ 3D:
      // Πρώτα η "σκιά"
      noStroke();
      fill(50, 50, 50, 100);
      ellipse(buttonCenterX + 3, buttonCenterY + 3, buttonRadius * 2, buttonRadius * 2);
      // Στη συνέχεια το κύριο κόκκινο κουμπί
      fill(255, 0, 0);
      ellipse(buttonCenterX, buttonCenterY, buttonRadius * 2, buttonRadius * 2);
    }
    
    function drawDrop() {
      push();
      fill(234, 234, 234);
      noStroke();
      ellipse(pipetX + pipetScaledW / 2, dropY, 10, 15);
      pop();
    }
    
    function startDrop() {
      if (!dropActive) {
        dropActive = true;
      }
    }
    
    function resetFill() {
      beakerFill = 0;
      dropY = initialDropY;
      dropActive = false;
      showBaseEllipse = false;
    }
    
    // Έλεγχος αν το κλικ έγινε μέσα στην περιοχή του εικονικού κουμπιού
    function mousePressed() {
      if (dist(mouseX, mouseY, buttonCenterX, buttonCenterY) < buttonRadius) {
        startDrop();
      }
    }
  </script>
  
  <div id="canvas-container"></div>
  <div id="controls" class="controls"></div>
</body>
</html>
